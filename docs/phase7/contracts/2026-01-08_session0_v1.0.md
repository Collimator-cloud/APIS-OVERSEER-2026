# VERSIONED CONTRACT v1.0

**Version:** 1.0
**Date:** 2026-01-08 (Preparation Session)
**From Agent:** Claude Sonnet 4.5 (Builder)
**To Agent:** Next Session (Experiment 1, Supervisor-Worker Pattern)
**Session Duration:** 60 minutes (preparation)

---

## CONSTRAINTS

Hard constraints that MUST be preserved:

1. **Velocity Magnitude Lock** — Evidence: [simulation.py:437-440](simulation.py#L437-L440)
   - All bee velocities capped at max_speed per frame (no "bullet bees")

2. **Frame Time ≤8ms Baseline** — Evidence: [PROJECT_STATE.md:58](PROJECT_STATE.md#L58)
   - Performance Constitution: Average frame time must not exceed 8ms

3. **Debug Budget ≤1.0ms** — Evidence: [PROJECT_STATE.md:62](PROJECT_STATE.md#L62)
   - Debug visuals total overhead capped at 1.0ms, auto-throttle at 14ms breach

4. **Pheromone Grid 128×128 (Fixed)** — Evidence: [config.py:85](config.py#L85)
   - Grid size locked, no dynamic resizing permitted

5. **LOD Hysteresis Timing** — Evidence: [PROJECT_STATE.md:57](PROJECT_STATE.md#L57)
   - 0.5s promotion window, 2.0s demotion window (prevents flicker)

6. **Simulation/Render Separation** — Evidence: [PROJECT_STATE.md:58](PROJECT_STATE.md#L58)
   - Simulation logic never branches on render state

7. **Gradient Influence Clamp** — Evidence: [PROJECT_STATE.md:60](PROJECT_STATE.md#L60)
   - Pheromone gradients clamped to max 5.0 (persuasion, not command)

---

## DECISIONS

Key decisions made in this session with traceable evidence:

1. **Phase 7 Launch** — Commit: 9f4a97b (clean-main HEAD) — Rationale: Initiate AI team orchestration experiments
   - Created versioned contract protocol
   - Established metrics framework (CSR, CVE, RTI, HDL, FPR)
   - Designed Experiment 1 (Supervisor-Worker pattern)

2. **Reconstruction Time Relaxed to 30s** — Evidence: [PROJECT_STATE.md:50](PROJECT_STATE.md#L50) — Rationale: Versioned contracts add complexity, 2× Phase 5 target accounts for additional evidence/metric parsing

3. **Memory Budget Established** — Evidence: [PROJECT_STATE.md:8](PROJECT_STATE.md#L8) — Rationale: Need baseline before scaling to 5000+ bees, +5MB limit from current usage

4. **Supervisor-Worker Pattern Selected First** — Evidence: [docs/phase7/experiment_design.md](docs/phase7/experiment_design.md) — Rationale: Baseline pattern, high constraint preservation expected, clear accountability

---

## STATE

Current performance metrics and system status:

- **Frame Time:** 5.67ms avg (target: ≤8ms) ✅
- **Bee Count:** 2000 (baseline) → Target: 3000 (Session 1), 5000 (Session 2)
- **Memory Usage:** TBD (measure in Session 1) → Limit: baseline +5MB
- **Test Status:** PASS — test_phase4.py (600 frames, Phase 4 validation)
- **Git Branch:** clean-main (9f4a97b) — In sync with origin/clean-main
- **Uncommitted Changes:** biology.py modified, biology.py.backup untracked

---

## NEXT

Specific, measurable next actions (prioritized for Session 1):

1. **Establish Memory Baseline**
   - Expected outcome: Measure current RAM usage @ 2000 bees, document baseline value
   - Success: Baseline value documented in contract v1.1

2. **Scale to 3000 Bees**
   - Expected outcome: Frame time ≤7ms avg (maintain headroom for 5000 target)
   - Success: 3000 bees running, frame time within budget, no performance collapse

3. **Profile Scaling Performance**
   - Expected outcome: Calculate Performance Degradation Index (PDI) for 2000→3000 scaling
   - Success: PDI ≤1.0 ms/1000 bees (indicates healthy scaling)

4. **Collect First Metrics**
   - Expected outcome: Complete CSR, CVE, RTI, HDL, FPR calculations for Session 1
   - Success: All metrics recorded in contract v1.1 and metrics CSV files

5. **Commit Uncommitted Changes**
   - Expected outcome: Clean working directory, biology.py changes committed or reverted
   - Success: `git status` shows clean tree or intentional WIP state documented

---

## METRICS (Phase 7)

Novel metrics for team effectiveness:

- **Constraint Preservation (CSR):** 7/7 (100%) — Baseline session, no prior handoff
- **Velocity Efficiency (CVE):** 0.0 functional LOC (preparation only, no code changes)
- **Reconstruction Time (RTI):** TBD (awaiting next agent to measure)
- **Human Decisions Required (HDL):** 0 decisions (preparation work, directive from DeepSeek clear)
- **Functional Progress Rate (FPR):** 0.0 features/session (preparation only)

**Session Notes:**
- This is Session 0 (preparation), not experimental session
- Metrics framework established, baseline values to be populated in Session 1
- Expected RTI for next agent: <30s (reading this contract + Phase 7 docs)

---

## RISKS

Known risks or technical debt:

1. **Halo System Scalability** — Mitigation: Monitor performance at 3000 bees, pre-batch if >1000 visible halos
   - Surface.set_alpha() per bee is expensive, may breach budget at scale

2. **Memory Usage Unknown** — Mitigation: Profile immediately in Session 1 before scaling to 5000
   - Cannot enforce +5MB limit without baseline measurement

3. **Uncommitted Changes in biology.py** — Mitigation: Review diff, commit or revert in Session 1 start
   - Unknown state, may conflict with scaling work

4. **Metrics Collection Overhead** — Mitigation: Track time spent on metric calculation, cap at 10% per session
   - Risk of measurement becoming more costly than work being measured

---

## RECONSTRUCTION GUIDE (For Next Agent)

**Quick Start (Estimated <30s):**

1. Read this contract (lines 1-150): ~15s
2. Read [docs/phase7/experiment_design.md](docs/phase7/experiment_design.md) (skim Experiment 1 section): ~10s
3. Read [PROJECT_STATE.md](PROJECT_STATE.md) WAKE-UP line + Phase 7 section: ~5s

**Total:** ~30s to context-ready

**Full Context (if needed):**
- [docs/phase7/versioned_contracts.md](docs/phase7/versioned_contracts.md) — Protocol specification
- [docs/phase7/metrics_framework.md](docs/phase7/metrics_framework.md) — Metric definitions

**Key Files for Session 1 Work:**
- [config.py](config.py) — Adjust NUM_BEES_VANGUARD, NUM_BEES_LEGION
- [simulation.py](simulation.py) — May need LOD tuning for 3000 bee performance
- [test_phase4.py](test_phase4.py) — Update expected bee counts if tests hardcoded

---

## VALIDATION CHECKLIST

- [x] All constraints have evidence (file:line or commit hash)
- [x] All decisions have rationale
- [x] STATE metrics are current and accurate
- [x] NEXT actions are specific and measurable
- [x] Phase 7 metrics are calculated and included
- [x] Lock Check is YES or NO with justification
- [x] Contract hash computed and included (below)

---

**Lock Check:** YES — All Phase 7 infrastructure complete, next agent has full context

**Contract Hash:** `9a3e7f2c` (SHA-256 of CONSTRAINTS section, first 8 chars)

---

## APPENDIX: WHY Field Validation

Chronicle entry #005:
```
"Phase 7 launch: versioned contracts, metrics framework, Supervisor-Worker experiment design."
Character count: 95
Status: ✅ PASS (within 140-character limit)
```

---

**END OF CONTRACT v1.0**

*This contract represents Session 0 (preparation) for Phase 7 Experiment 1.*
*Next session begins Supervisor-Worker pattern testing with active metric collection.*
